<html>
<head>
    <meta charset="utf-8"/>
<meta name="description" content=""/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>[éº»é›€ä¸€å·]åƒåœ¾åˆ†ç±»åŠ©æ‰‹å¼€å‘å†ç¨‹ | å­¦ä¹ å°ç»„</title>
<link rel="shortcut icon" href="https://baldstudio.cn/favicon.ico?v=1588319411513">
<link href="https://cdn.bootcss.com/font-awesome/5.11.2/css/all.css" rel="stylesheet">
<link rel="stylesheet" href="https://baldstudio.cn/styles/main.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

<script src="https://cdn.bootcss.com/highlight.js/9.15.10/highlight.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dockerfile.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/dart.min.js"></script>
<script src="https://cdn.bootcss.com/highlight.js/9.15.10/languages/go.min.js"></script>
<script src="https://cdn.bootcss.com/moment.js/2.23.0/moment.min.js"></script>
<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>

<!-- DEMO JS -->
<!--<script src="media/scripts/index.js"></script>-->



    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
</head>
<body>
<div class="main gt-bg-theme-color-first">
    <nav class="navbar navbar-expand-lg">
    <div class="navbar-brand">
        <img class="user-avatar" src="/images/avatar.png" alt="å¤´åƒ">
        <div class="site-name gt-c-content-color-first">
            å­¦ä¹ å°ç»„
        </div>
    </div>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <i class="fas fa-bars gt-c-content-color-first" style="font-size: 18px"></i>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <div class="navbar-nav mr-auto" style="text-align: center">
            
                <div class="nav-item">
                    
                        <a href="/" class="menu gt-a-link">
                            é¦–é¡µ
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/archives" class="menu gt-a-link">
                            å½’æ¡£
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/tags" class="menu gt-a-link">
                            æ ‡ç­¾
                        </a>
                    
                </div>
            
                <div class="nav-item">
                    
                        <a href="/post/about" class="menu gt-a-link">
                            å…³äº
                        </a>
                    
                </div>
            
        </div>
    </div>
</nav>
    <div class="post-container">
        <div class="post-detail gt-bg-theme-color-second">
            <article class="gt-post-content">
                <h2 class="post-title">
                    [éº»é›€ä¸€å·]åƒåœ¾åˆ†ç±»åŠ©æ‰‹å¼€å‘å†ç¨‹
                </h2>
                <div class="post-info">
                    <time class="post-time gt-c-content-color-first">
                        Â· 2020-04-13 Â·
                    </time>
                    
                        <a href="https://baldstudio.cn/tag/tIHJO5Wum/" class="post-tags">
                            # å•ç‰‡æœº
                        </a>
                    
                </div>
                <div class="post-content">
                    <p><strong>ä½œè€…: è’‹æ™¨è¾‰</strong></p>
<h2 id="ç®€å•ä»‹ç»">ç®€å•ä»‹ç»</h2>
<p>æœ€è¿‘å‚åŠ äº†RT-Threadåº”ç”¨åˆ›æ–°è®¾è®¡å¤§èµ›,å¯ä»¥ç™½å«–å¼€å‘æ¿,æ‹¿åæ¬¡è¿˜æœ‰å¥–é‡‘,æŠ±ç€åˆ·å±¥å†å’Œç™½å«–å¼€å‘æ¿çš„å¿ƒæƒ…,æˆ‘æŠ¥äº†è¿™ä¸ªæ¯”èµ›.é¡¹ç›®æœ€ç»ˆå®šä¸ºåƒåœ¾åˆ†ç±»åŠ©æ‰‹,å¤§è‡´åŠŸèƒ½æ˜¯æŒ‰ä¸‹æŒ‰é”®,æ‘„åƒå¤´æ‹ç…§,å°†ç…§ç‰‡å‘é€åˆ°äº‘ç«¯è¿›è¡Œè¯†åˆ«,äº‘ç«¯ä¼šæŠŠè¯†åˆ«ç»“æœè½¬æˆè¯­éŸ³,è¿”å›ç»™å¼€å‘æ¿,ç„¶åå¼€å‘æ¿æ’­æ”¾è¯†åˆ«ç»“æœ.<br>
æˆ‘ç”³è¯·çš„æ˜¯éº»é›€ä¸€å·å¼€å‘æ¿,ä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹è¿™å—å¼€å‘æ¿<br>
<img src="https://baldstudio.cn/post-images/1586789929216.jpg" alt="" loading="lazy"></p>
<blockquote>
<p>éº»é›€ä¸€å·å¼€å‘æ¿é‡‡ç”¨çš„ä¸»æ§èŠ¯ç‰‡æ˜¯ BK7252 , æ˜¯ä¸€æ¬¾é«˜æ€§èƒ½ WiFi æ¨¡å—ï¼Œé‡‡ç”¨é«˜é›†æˆçš„æ— çº¿å°„é¢‘èŠ¯ç‰‡,å†…éƒ¨é›†æˆ 2.4GHz Wi-Fi 1T1R å…ˆè¿›æŠ€æœ¯ï¼Œæ”¯æŒæ‘„åƒå¤´å›¾åƒè¾“å‡ºï¼Œæ‹¥æœ‰æœ€ä½³çš„åŠŸè€—æ€§èƒ½ã€å°„é¢‘æ€§èƒ½ã€ç¨³å®šæ€§ã€é€šç”¨æ€§å’Œå¯é æ€§ï¼Œé€‚ç”¨äºå„ç§åº”ç”¨å’Œä¸åŒäº§å“éœ€æ±‚ã€‚æ¨¡å—å†…éƒ¨æ‹¥æœ‰ 512KB å†…åµŒ RAM å’Œ 4Mbyte Flash ç©ºé—´ï¼Œ CPU ä¸»é¢‘é«˜è¾¾ 180Mhzã€‚å¹¶ä¸”é›†æˆäº†å¤©çº¿å¼€å…³ã€åŠŸç‡æ”¾å¤§å™¨ã€ä½å™ªæ”¾å¤§å™¨ã€è¿‡æ»¤å™¨ã€ç”µæºç®¡ç†æ¨¡å—, æ”¯æŒ 802.11e ä»¥åŠ WMM-PS åè®®, æ”¯æŒ WPAã€ WPA2 å’Œ WAPI å®‰å…¨åè®®ï¼ŒåŒæ—¶é›†æˆäº†è“ç‰™ BLE æ”¶å‘å™¨ï¼Œæ”¯æŒ BLE4.2ï¼Œæ”¯æŒä¸»æœºæˆ–ä»æœºæ¨¡å¼ã€‚</p>
</blockquote>
<p>å®˜æ–¹æä¾›çš„sdkæ˜¯åŸºäºRT-Thread v3.0.1çš„,ç‰ˆæœ¬æœ‰ç‚¹è€,ç•¥å¾®æœ‰ç‚¹è®©äººæœ‰ç‚¹ä¸çˆ½,æƒ³è‡ªå·±é€‚é…æœ€æ–°ç‰ˆ,å¯æ˜¯æŠ¥äº†å¥½å¤šé”™,è¿˜æ˜¯å…ˆè€è€å®å®ç”¨å®˜æ–¹çš„å§ğŸ˜‚.<br>
<img src="https://baldstudio.cn/post-images/1586790191438.png" alt="" loading="lazy"><br>
ä½“éªŒäº†ä¸€ä¸‹å­ä¹‹å,å‘ç°å®˜æ–¹sdkçš„åŠŸèƒ½å·²ç»å¾ˆå®Œå–„äº†,åŸºæœ¬æŠŠè¿™å—æ¿ä¸Šæ‰€æœ‰èµ„æºéƒ½ç”¨åˆ°äº†.ä½†æ˜¯ä¾ç„¶æœ‰ç‚¹é—æ†¾,å®˜æ–¹çš„menuconfigæ²¡æœ‰é€‚é…å¥½.æ—©æœŸé€‚é…äº†ä¸€ä¸‹ä¹‹å,å°±éƒ½åœ¨ç›´æ¥æ”¹&lt;rtconfig.h&gt;.å¯¼è‡´ä¸€æ—¦ä½¿ç”¨menuconfigå,ä¼šç¼ºå°‘å¤§é‡å®å®šä¹‰å¯¼è‡´ç¼–è¯‘å¤±è´¥.</p>
<h2 id="å¦‚ä½•ä½¿ç”¨">å¦‚ä½•ä½¿ç”¨</h2>
<p>æˆ‘åŸæ¥ä½¿ç”¨äº†å¾ˆä¹…çš„STM32,ç†Ÿæ‚‰äº†ä½¿ç”¨jlinkä¸‹è½½çš„æ–¹å¼,æ‹¿åˆ°è¿™å—æ¿,çªç„¶å‘ç°ä¸èƒ½ä½¿ç”¨jlink,åªèƒ½ç”¨ä¸²å£ä¸‹è½½çš„æ–¹å¼,æœ‰ç‚¹æ‡µé€¼ğŸ˜µ.ä»¥å‰æ¥è§¦è¿‡ä¸²å£ä¸‹è½½,å”¯ä¸€çš„æ„Ÿè§‰å°±æ˜¯æ…¢,è¿˜ä¸èƒ½æ‰“æ–­ç‚¹è°ƒè¯•.<br>
å®˜æ–¹çš„æ‰‹å†Œé‡Œä»‹ç»äº†ä¸¤ç§æ–¹å¼ä¸‹è½½å›ºä»¶.</p>
<ul>
<li>æ— çº¿çƒ§å½•å™¨çƒ§å½•<br>
éšå¼€å‘æ¿é™„èµ äº†ä¸€ä¸ªæ— çº¿çƒ§å½•å™¨,æ— çº¿çƒ§å½•å™¨æœ¬èº«è¿è¡Œåœ¨APçƒ­ç‚¹æ¨¡å¼.å°†æ— çº¿çƒ§å½•å™¨æ’åœ¨å¼€å‘æ¿ä¸Š,è¿æ¥çƒ§å½•å™¨å‘å‡ºçš„wifi,æ‰“å¼€çƒ§å½•å™¨çš„çƒ§å½•é¡µé¢,ä¸Šä¼ å›ºä»¶æ›´æ–°.è¿™ç§æ–¹å¼å¾ˆéº»çƒ¦,ä¸‹è½½ä¸€æ¬¡å›ºä»¶éœ€è¦2åˆ†é’Ÿå·¦å³.</li>
<li>http_otaæ›´æ–°<br>
å½“å¼€å‘æ¿è¿æ¥ä¸Šwifiå,å¯ä»¥ä½¿ç”¨otaæ›´æ–°,è‡ªå·±çš„ç”µè„‘ä¸Šè¿è¡Œä¸€ä¸ªwebæœåŠ¡å™¨,æŠŠæ›´æ–°å›ºä»¶æ”¾åœ¨æœåŠ¡å™¨å·¥ä½œç›®å½•é‡Œ,å¼€å‘æ¿å…ˆæŠŠæ–‡ä»¶ä¸‹è½½åˆ°downloadåˆ†åŒº,é‡å¯åè¿›å…¥bootloader,æŠŠdownloadåˆ†åŒºä¸­çš„å›ºä»¶å†™å…¥appåˆ†åŒºé‡Œ.ä¹‹åé‡å¯,è¿™ç§æ–¹å¼è¿˜å¯ä»¥æ¥å—.å¤§æ¦‚ä¸€åˆ†é’Ÿå·¦å³.æœ‰å‡ ä¸ªè¦æ³¨æ„çš„ç‚¹</li>
</ul>
<ol>
<li>ä¸èƒ½ç›´æ¥ç”¨rtthread.binå‡çº§,é¦–å…ˆè¦ä½¿ç”¨otaæ‰“åŒ…å·¥å…·æ‰“åŒ…æˆbootloaderå¯ä»¥ä½¿ç”¨çš„åŒ….</li>
<li>æ‰“åŒ…çš„é€‰é¡¹è¦å’Œå›¾ä¸­ä¸€è‡´.æˆ‘ä¹‹å‰å› ä¸ºæ²¡æœ‰ä½¿ç”¨å‹ç¼©,å¯¼è‡´åŒ…å¤ªå¤§,æ— æ³•ä¸‹è½½åˆ°å¼€å‘æ¿ä¸­,æ²¡æœ‰ä½¿ç”¨åŠ å¯†,å¼€å‘æ¿ä¸æ¥å—æ²¡æœ‰åŠ å¯†è¿‡çš„åŒ….ç‰ˆæœ¬å·ä¸€å®šè¦æ¯”å¼€å‘æ¿ä¸­è¿è¡Œçš„å›ºä»¶ç‰ˆæœ¬å·é«˜,ä¸ç„¶æ— æ³•æ›´æ–°.<br>
<img src="https://baldstudio.cn/post-images/1586832193569.png" alt="" loading="lazy"></li>
</ol>
<h2 id="å¼€å‘è¿›åº¦">å¼€å‘è¿›åº¦</h2>
<ul>
<li>å¼€æœºè‡ªåŠ¨è¿æ¥wifi<br>
å®˜æ–¹æä¾›äº†wifiçš„MSHå‘½ä»¤,ä½¿ç”¨æ–¹å¼æ˜¯&quot;wifi w0 join ssid key&quot;,é€šè¿‡é˜…è¯»rtthread/comptents/wlan/wlan_cmd.cä¸­çš„æºç ,å°†è¿æ¥wifiçš„ä»£ç æ”¾åˆ°äº†ä¸»å‡½æ•°ä¸­,å®ç°ä¸Šç”µå³å¯è¿æ¥wifi.</li>
</ul>
<pre><code class="language-c">void wlan_connect(){

    #define wifi_ssid &quot;TP-LINK_1&quot;
    #define wifi_key &quot;jia555555&quot;

    rt_kprintf(&quot;wifiè¿æ¥ä¸­...\r\n&quot;);
    struct rt_wlan_info info;
    int result = 0;

    struct rt_wlan_device *wlan = (struct rt_wlan_device*)rt_device_find(&quot;w0&quot;);

    if(wlan == RT_NULL){
        rt_kprintf(&quot;è®¾å¤‡æœªæ‰¾åˆ°!\r\n&quot;);
    }

    rt_wlan_info_init(&amp;info, WIFI_STATION, SECURITY_WPA2_MIXED_PSK, wifi_ssid);

    result = rt_wlan_init(wlan, WIFI_STATION);

    if (result == RT_EOK)
    {
        result = rt_wlan_connect(wlan, &amp;info, wifi_key);
        if(result == RT_EOK)
        {
            rt_kprintf(&quot;wifiå·²è¿æ¥!\r\n&quot;);
        }
        else
        {
            rt_kprintf(&quot;wifiè¿æ¥å¤±è´¥!\r\n&quot;);
        }
    }
}
</code></pre>
<ul>
<li>å›¾ç‰‡è½¬base64<br>
æœ¬æ¥å‡†å¤‡è‡ªå·±å®ç°,åæ¥å‘ç°rttæœ‰ä¸€ä¸ªpackage,å«åštinycrtpt,ä¸ºåµŒå…¥å¼è®¾å¤‡æä¾›äº†å¸¸ç”¨çš„åŠ å¯†æ–¹å¼çš„åŠ è§£å¯†.å…¶ä¸­å°±åŒ…æ‹¬äº†base64.åœ¨rtconfig.hä¸­æ·»åŠ å®å®šä¹‰å¼€å¯tinycryptå,åœ¨ä¸»å‡½æ•°ä¸­å¼•å…¥å¤´æ–‡ä»¶&quot;tinycrypt.h&quot;å³å¯ä½¿ç”¨ç›¸å…³å‡½æ•°.<br>
ä¸€å¼ 320x240çš„ç…§ç‰‡å¤§å°æ˜¯22kå·¦å³,äºæ˜¯å…ˆè¦æœ‰ä¸€ä¸ªæ•°ç»„ç¼“å­˜ç…§ç‰‡å†…å®¹,ä½¿ç”¨rt_mallocè·å–24kçš„unsigned char æ•°ç»„ç©ºé—´.base64è½¬ç å®Œå¤§çº¦éœ€è¦33kçš„ç©ºé—´,åŒæ ·ä¹Ÿè¦ä½¿ç”¨rt_mallocæ¥è·å–.æˆ‘å†™äº†ä¸€ä¸ªdemo,æš‚æ—¶å…ˆå°†base64ç»“æœå­˜å…¥sdå¡ä¸­.æ•´ä¸ªè½¬ç è¿‡ç¨‹å¾ˆå¿«,å‡ ä¹æ„Ÿè§‰ä¸åˆ°è€—æ—¶.å‰å‡ æ¬¡ç”±äºæ¥æ”¶æ•°ç»„çš„ç©ºé—´å¤ªå°,å¯¼è‡´ç¨‹åºå¡æ­»,ä»”ç»†ç ”ç©¶æºç å,ç¡®å®šäº†åˆé€‚çš„æ•°ç»„å¤§å°.ç¨‹åºé¡ºåˆ©è¿è¡Œ.<br>
åœ¨è¿›è¡Œä¼˜åŒ–ä¹‹å,ä»sdå¡ä¸­è¯»å–å›¾ç‰‡ä¹‹å,æ— éœ€åœ¨å†™å…¥SDå¡,è€Œæ˜¯å°†ç»“æœèµ‹ç»™æŒ‡é’ˆ,è¿”å›ç»™è°ƒç”¨çš„å‡½æ•°.<br>
æ›´åŠ èŠ‚çœèµ„æº,å‡å°‘æ—¶é—´å¼€é”€.</li>
</ul>
<pre><code class="language-c">int photo2base64(const char * path,unsigned char * dst)
{
    int fd = open(path,O_RDONLY);
    unsigned char *img = RT_NULL;
    img = (unsigned char *)rt_malloc(sizeof(unsigned char)*1024*24);
    if(img==RT_NULL || dst==RT_NULL)
    {
        rt_kprintf(&quot;å†…å­˜åˆ†é…å¤±è´¥\r\n&quot;);
    }
    int res = read(fd, img, 1024*24);
    close(fd);
    rt_kprintf(&quot;res=%d\r\n&quot;,res);
    int len = 1024*40;
    tiny_base64_encode(dst,&amp;len,img,1024*24);
    rt_kprintf(&quot;len=%d\r\n&quot;,len);
    rt_free(img);
    return len;
}
</code></pre>
<ul>
<li>å®ç°GETè¯·æ±‚<br>
ä½¿ç”¨webclientå¯ä»¥å®ç°getè¯·æ±‚,å¯ä»¥åœ¨ç»ˆç«¯æ‰“å°å‡ºç»“æœ,æˆ‘åœ¨PCä¸Šç”¨Pythonè°ƒå¼çš„æ—¶å€™,ç”¨äº†å‡ åˆ†é’Ÿå°±è°ƒé€šäº†apiæ¥å£.å¯æ˜¯å½“æˆ‘åœ¨å¼€å‘æ¿ä¸Šè¿›è¡Œè°ƒç”¨çš„æ—¶å€™,é¢‘é¢‘å‡ºç°é—®é¢˜.å› ä¸ºPythonçš„åº“å°è£…çš„å¤ªå¥½äº†,ä»¥è‡³äºå¾ˆå¤šç»†èŠ‚éƒ½æ˜¯æˆ‘ä»¥å‰æ²¡æœ‰è€ƒè™‘è¿‡å¾—.è¸©äº†å¾ˆå¤šå‘.æ‰æŠŠapiè°ƒé€š.<br>
æˆ‘ä¸»è¦çš„é—®é¢˜æ˜¯å‡ºç°åœ¨POSTè¯·æ±‚æ—¶çš„å‚æ•°æ ¼å¼ä¸å¯¹.æˆ‘ä¸€ç›´ä»¥ä¸ºåº”è¯¥æ˜¯Urlencode(æ•°æ®å¤´+Base64(å›¾ç‰‡)),ä½†åæ¥ç”¨FiddleræŠ“åŒ…çš„æ—¶å€™,ä»”ç»†åˆ†æ,å‘ç°åº”è¯¥æ˜¯æ•°æ®å¤´+Urlencode(Base64(å›¾ç‰‡)),æŠŠå‚æ•°çš„æ ¼å¼è°ƒæ•´æ­£ç¡®ä¹‹å,æ€»ç®—æ˜¯è°ƒé€šäº†api</li>
</ul>
<pre><code class="language-c">int base64_test(int argc, char **argv)
{
    char *uri = RT_NULL;
    uri = web_strdup(&quot;http://api.tianapi.com/txapi/imglajifenlei/index&quot;);
    if(uri == RT_NULL)
    {
        rt_kprintf(&quot;no memory for create post request uri buffer.\n&quot;);
        return -RT_ENOMEM;
    }

    unsigned char *dst = (unsigned char *)rt_malloc(sizeof(unsigned char)*1024*40);
    photo2base64(argv[1],dst);

    unsigned char *buffer = (unsigned char *)rt_malloc(sizeof(unsigned char)*1024*40);
    rt_sprintf(buffer,&quot;img=data:image/jpg;base64,%s&quot;,dst);
    memset(dst,0,rt_strlen(dst));   
    URLEncode(buffer, rt_strlen(buffer), dst, 1024*40);
    memset(buffer,0,rt_strlen(buffer));    
    rt_sprintf(buffer,&quot;key=acda67d9ac820ea200a26f73d0b41adf&amp;img=%s&quot;,dst);
    webclient_post_comm(uri, buffer);
    
    web_free(uri);
    rt_free(dst);
    rt_free(buffer);
}
</code></pre>
<ul>
<li>å®ç°è¯­éŸ³æ’­æŠ¥<br>
ä½¿ç”¨ç™¾åº¦çš„è¯­éŸ³åˆæˆAPI,åœ¨æ¯”è¾ƒäº†å‡ å®¶ä¸»è¦çš„APIå‚å•†å,è¿˜æ˜¯å†³å®šç”¨ç™¾åº¦çš„,å› ä¸ºä»–çš„APIè°ƒç”¨æ–¹ä¾¿,é‰´æƒç®€å•.å®¹æ˜“åœ¨å•ç‰‡æœºä¸Šå®ç°.</li>
</ul>
<pre><code class="language-c">int tts_test(int argc, char **argv)
{
    unsigned char *url = RT_NULL;
    unsigned char *text1 = RT_NULL;
    unsigned char *text2 = RT_NULL;
    char *origin = &quot;å¯å›æ”¶åƒåœ¾,ä¸å¯å›æ”¶åƒåœ¾,åƒåœ¾åƒåœ¾éƒ½æ˜¯åƒåœ¾&quot;;
    char *token = &quot;24.77fdd5e29e31191ee6c060718b68da99.2592000.1589599990.282335-16279726&quot;;

    text1 = (unsigned char *)rt_malloc(sizeof(unsigned char) * 1024 * 20);

    URLEncode(origin, rt_strlen(origin), text1, 1024 * 20);
    print_base64(text1, rt_strlen(text1));

    text2 = (unsigned char *)rt_malloc(sizeof(unsigned char) * 1024 * 20);
    URLEncode(text1, rt_strlen(text1), text2, 1024 * 20);
    rt_free(text1);
    print_base64(text2, rt_strlen(text2));
    url = (unsigned char *)rt_malloc(sizeof(unsigned char) * 1024 * 30);
    rt_sprintf(url, &quot;http://tsn.baidu.com/text2audio?tok=%s&amp;tex=%s&amp;per=4&amp;spd=5&amp;pit=5&amp;vol=5&amp;aue=3&amp;cuid=123456PYTHON&amp;lan=zh&amp;ctp=1&quot;, token, text2);
    rt_free(text2);
    print_base64(url, rt_strlen(url));
    char *uri = web_strdup(url);
    webclient_get_file(uri, &quot;/sd/audio.mp3&quot;);
    web_free(uri);
    rt_free(url);
    return 0;
}
MSH_CMD_EXPORT(tts_test, tts test);
</code></pre>
<ul>
<li>æŒ‰ä¸‹æŒ‰é”®æ‹ç…§,å¹¶æŠŠç…§ç‰‡å­˜å‚¨åˆ°sdå¡<br>
è¿™ä¸ªå®ç°éš¾åº¦è¾ƒå°,å¯ä»¥å‚è€ƒå®˜æ–¹çš„ä¾‹å­è¿›è¡Œç®€å•æ”¹åŠ¨å³å¯.</li>
</ul>
<pre><code class="language-c">int key_photo(int argc, char **argv)
{
    session.event = rt_event_create(&quot;vt_event&quot;, RT_IPC_FLAG_FIFO);
    #define KEY_MID (13)
    rt_pin_mode(KEY_MID, PIN_MODE_INPUT_PULLUP);
    while (1)
    {
        if (rt_pin_read(KEY_MID) == PIN_LOW)
        {
            rt_thread_delay(80);
            if (rt_pin_read(KEY_MID) == PIN_LOW)
            {
                LOG_I(&quot;KEY_MID is pressed&quot;);
                LOG_I(&quot;æ­£åœ¨å¼€å¯æ‘„åƒå¤´...&quot;);
                camera_start(); //å¼€å¯æ‘„åƒå¤´ä¼ è¾“ç…§ç‰‡
                tvideo_capture(1);
                rt_event_recv(session.event, SEND_FRAME_EVENT, RT_EVENT_FLAG_OR | RT_EVENT_FLAG_CLEAR, RT_WAITING_FOREVER, RT_NULL);

                int fd, res;
                rt_sprintf(file_name, &quot;/sd/temp.jpg&quot;, file_count);
                LOG_I(&quot;name = %s \n&quot;, file_name);
                fd = open(file_name, O_WRONLY | O_CREAT);
                if (fd &gt;= 0)
                {
                    write(fd, session.buf, session.total_len);
                    LOG_I(&quot;session.total_len=%d\r\n&quot;, session.total_len);
                    close(fd);
                    LOG_I(&quot;save %s ok!!!\n&quot;, file_name);
                    rt_sem_release(sem_base64);
                    res = Decode_Jpg(file_name);
                    LOG_I(&quot;res = %d\n&quot;, res);
                }
                else
                {
                    LOG_E(&quot;save pic failed!!!\n&quot;);
                }
                tvideo_capture(0);
            }
        }
    }
    return 0;
}
MSH_CMD_EXPORT(key_photo, key photo);
</code></pre>
<h2 id="è”åˆè°ƒè¯•">è”åˆè°ƒè¯•</h2>
<p>åœ¨å®Œæˆå„å•é¡¹åŠŸèƒ½ä¹‹å,æˆ‘å¼€å§‹å°†è¿™äº›åŠŸèƒ½è”åˆèµ·æ¥è°ƒè¯•.ä»1.0.0ä¸æ–­è¿­ä»£åˆ°1.9.1,ç»å†äº†90å¤šæ¬¡è¿­ä»£,å…­ç™¾å¤šè¡Œä»£ç ,æ‰æŠŠè¿™äº›åŠŸèƒ½è°ƒé€š.å¥½åœ¨æœ€åæ‰€æœ‰åŠŸèƒ½éƒ½æ­£å¸¸.ä¸‹é¢æ˜¯æ€»çš„ç³»ç»Ÿæ¡†å›¾.<br>
<img src="https://baldstudio.cn/post-images/1587376262709.png" alt="" loading="lazy"></p>
<h2 id="æ¼”ç¤ºæ•ˆæœ">æ¼”ç¤ºæ•ˆæœ</h2>
<p><video src="../../images/VID20200419195427.mp4"  controls='0' height=auto width=100%> </video></p>
<h2 id="ä»£ç åœ°å€">ä»£ç åœ°å€</h2>
<p><a href="https://github.com/jch12138/Garbage-sorting-assistant">åƒåœ¾åˆ†ç±»åŠ©æ‰‹</a></p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>é€šè¿‡å¤§çº¦ä¸€ç¤¼æ‹œçš„å¼€å‘,æ€»ç®—æ˜¯å®Œæˆäº†è¿™ä¸ªé¡¹ç›®,å¦‚æœæ˜¯åœ¨PCä¸Šå¼€å‘,ä½¿ç”¨é«˜çº§è¯­è¨€,æˆ‘æƒ³ä¸€ä¸ªä¸‹åˆå°±èƒ½æå®š,åœ¨åµŒå…¥å¼è®¾å¤‡ä¸Šè¿›è¡Œè°ƒè¯•è´¹æ—¶è´¹åŠ›,æ›´åŠ è€ƒéªŒä½ å¯¹ç»†èŠ‚çš„æŠŠæ¡.æ¯”å¦‚åœ¨è°ƒç”¨apiæ—¶,Pythoné‡Œä¸ç”¨å…³å¿ƒå‚æ•°çš„ç¼–ç ,åœ¨cé‡Œè¦è‡ªå·±æŒæ§æ¯ä¸ªç¯èŠ‚.è¿™æ¬¡ä½¿ç”¨rtthread,å¯¹äºå†…å­˜çš„ä½¿ç”¨ç†è§£æ›´æ·±äº†,å­¦ä¼šäº†ä½¿ç”¨malloc,ä¸å†åƒä»¥å‰åªä¼šä½¿ç”¨é™æ€æ•°ç»„äº†.å­¦ä¼šå¦‚ä½•èŠ‚çœå†…å­˜,å¦‚ä½•é€‰æ‹©å†…å­˜æ± .æ›´å¥½çš„åˆ†é…å†…å­˜,æé«˜ç³»ç»Ÿè¿è¡Œæ•ˆç‡.</p>

                </div>
            </article>
        </div>

        
            <div class="next-post">
                <div class="next gt-c-content-color-first">ä¸‹ä¸€ç¯‡</div>
                <a href="https://baldstudio.cn/post/cheng-gong-wei-rt-thread-zhu-xian-gong-xian-dai-ma/" class="post-title gt-a-link">
                    æˆåŠŸä¸ºRT-Threadä¸»çº¿è´¡çŒ®ä»£ç ğŸ˜
                </a>
            </div>
        

        

        <div class="site-footer gt-c-content-color-first">
    <div class="slogan gt-c-content-color-first">Keep Foolish, Keep Hungry</div>
    <div class="social-container">
        
            
        
            
        
            
        
            
        
            
        
            
        
    </div>
    <div class="footer-info">
        Powered by <a href="https://github.com/jch2138" target="_blank">BalDStudio</a>
    </div>
    <div>
        Theme by <a href="https://imhanjie.com/" target="_blank">imhanjie</a>, Powered by <a
                href="https://github.com/getgridea/gridea" target="_blank">Gridea | <a href="https://baldstudio.cn/atom.xml" target="_blank">RSS</a></a>
    </div>
</div>

<script>
    hljs.initHighlightingOnLoad()
</script>


    </div>
</div>
</body>
</html>
